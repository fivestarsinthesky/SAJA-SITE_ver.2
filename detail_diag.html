<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>진단용 상세 페이지</title>
<style>
  :root{ --gap:16px; --left:60%; --right:40%; --maxw:1400px; --ink:#111; }
  *{ box-sizing:border-box; }
  html, body { height:100%; }
  body{ margin:0; font-family:system-ui,"Noto Sans KR",sans-serif; color:var(--ink);
        display:flex; flex-direction:column; overflow:hidden; background:#fafafa; }
  header{ padding:8px 12px; border-bottom:2px dashed #f0a500; background:#fff; }
  .page{ flex:1 1 auto; max-width:none; width:100vw; margin:0 auto; padding:12px; overflow:hidden; }
  .pc-grid{ display:grid; gap:var(--gap); grid-template-columns:var(--left) var(--right); height:100%; min-height:0; }
  .left-col{ display:grid; gap:var(--gap); grid-template-rows:auto auto; min-height:0; }
  .card{ border:2px dashed #7aa2ff; border-radius:12px; background:#fff; overflow:hidden; }
  .player{ position:relative; background:#000; }
  .player::before{ content:""; display:block; padding-top:56.25%; }
  .player iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
  .menu{ padding:8px; display:flex; gap:8px; }
  .tab{ border:1px solid #ddd; background:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:700; }
  .tab[aria-pressed="true"]{ background:#111; color:#fff; border-color:#111; }
  .content.card{ display:flex; flex-direction:column; height:100%; min-height:0; overflow:hidden; border-color:#9ccc65; }
  .content-header{ padding:8px 12px; border-bottom:1px solid #eee; }
  .content-title{ margin:0; font-size:18px; }
  .content-meta{ margin-top:4px; opacity:.7; font-size:13px; }
  .content-body{ flex:1 1 auto; min-height:0; }
  .content-iframe{ display:block; width:100%; height:100%; border:0; background:#181818; }
  @media (max-width:900px){
    .pc-grid{ display:block; height:100%; }
    .left-col{ display:block; }
    .content.card{ height:50vh; }
  }
</style>
</head>
<body>
  <header>진단용: 유튜브/가사/더보기 표시 테스트 (tracks.js 없이 동작)</header>
  <div class="page">
    <div class="pc-grid">
      <div class="left-col">
        <div class="card player">
          <iframe id="yt" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="card">
          <div class="menu" role="group" aria-label="콘텐츠 선택">
            <button class="tab" data-panel="lyrics" aria-pressed="true">가사</button>
            <button class="tab" data-panel="more" aria-pressed="false">더보기</button>
          </div>
        </div>
      </div>

      <div class="content card">
        <div class="content-header">
          <h2 id="cTitle" class="content-title">가사</h2>
          <div id="cMeta" class="content-meta"></div>
        </div>
        <div class="content-body">
          <iframe id="panelFrame" class="content-iframe" title="가사/더보기"></iframe>
        </div>
      </div>
    </div>
  </div>

<script>
  // 데모 데이터(진단용) — tracks.js 없이 동작
  var DEMO = {
    artist: "성시경",
    title: "안녕 나의 사랑",
    youtube: "https://www.youtube.com/watch?v=th2Mif86ZPI",
    lyrics: "[Lyrics] 성시경 - 안녕 나의 사랑\n\n여름 냄새 벌써 이 거리에... (생략)",
    more: "이건 진단용 더보기 텍스트입니다. 글이 보이면 iframe 패널 정상."
  };

  function extractYouTubeId(url){
    if(!url) return "";
    try{
      let m = url.match(/youtu\.be\/([a-zA-Z0-9_-]{6,})/);
      if(m && m[1]) return m[1];
      m = url.match(/[?&]v=([a-zA-Z0-9_-]{6,})/);
      if(m && m[1]) return m[1];
      m = url.match(/embed\/([a-zA-Z0-9_-]{6,})/);
      if(m && m[1]) return m[1];
      return "";
    }catch(e){ return ""; }
  }
  function toEmbed(url){
    const id = extractYouTubeId(url);
    return id ? ("https://www.youtube.com/embed/" + encodeURIComponent(id) + "?rel=0") : "";
  }
  function esc(s){ return (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
  function toHtml(title, body){
    return `<!doctype html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  html,body{height:100%} body{margin:0;padding:14px;background:#181818;color:#fff;font-family:system-ui,"Noto Sans KR",sans-serif;line-height:1.55;font-size:16px;overflow:auto;-webkit-overflow-scrolling:touch}
  h1{font-size:18px;margin:0 0 10px 0}
  .mono{white-space:pre-wrap;word-break:keep-all}
</style></head><body>
  <h1>${title}</h1>
  <div class="mono">${body}</div>
</body></html>`;
  }

  // 헤더
  document.getElementById('cMeta').textContent = DEMO.artist + " · " + DEMO.title;
  document.title = "진단용 상세 | " + DEMO.artist + " — " + DEMO.title;

  // 유튜브
  const $yt = document.getElementById('yt');
  $yt.src = toEmbed(DEMO.youtube) || "https://www.youtube.com/embed/dQw4w9WgXcQ?rel=0";

  // 패널
  const $panel = document.getElementById('panelFrame');
  function setPanel(html){
    try{ $panel.srcdoc = html; }catch(e){}
    try{ $panel.src = "data:text/html;charset=utf-8," + encodeURIComponent(html); }catch(e){}
  }
  function show(which){
    if(which==='more'){
      document.getElementById('cTitle').textContent = '더보기';
      setPanel(toHtml('더보기', esc(DEMO.more).replace(/\n/g,'<br>')));
    }else{
      document.getElementById('cTitle').textContent = '가사';
      setPanel(toHtml('가사', esc(DEMO.lyrics).replace(/\n/g,'<br>')));
    }
  }
  show('lyrics');

  document.querySelectorAll('.menu .tab').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.menu .tab').forEach(b=>b.setAttribute('aria-pressed','false'));
      btn.setAttribute('aria-pressed','true');
      show(btn.dataset.panel);
    });
  });

  console.log("[진단] 페이지 로드 OK");
</script>
</body>
</html>
